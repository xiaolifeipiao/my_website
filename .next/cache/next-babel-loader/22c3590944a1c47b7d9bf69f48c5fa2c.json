{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useEffect, useRef, useContext } from 'react';\nimport classNames from 'classnames';\nimport Lazyload from 'react-lazyload';\nimport { StickyContainer, Sticky } from '@components/react-sticky';\nimport InfiniteScroll from 'react-infinite-scroller';\nimport styles from '@styles/sass/page/works.module.scss';\nimport { findDataIndex, getStyle, paginationAfterData, isValidArray } from '@scripts/utils';\nimport { DEFAULT_PAGE_SIZE } from '@scripts/constant';\nimport { worksInfo } from '@store/mock';\nimport { CtxStore } from '../components/context';\nimport { Banner, SvgIcon, Loading } from '@components/common';\nimport { LayoutMain } from '@components/layout';\nimport { ReactComponent as SvgPaperPlane } from '@fonts/svg/merge/paper-plane.svg';\nvar works_wrapper = styles.works_wrapper,\n    works_list = styles.works_list;\nvar worksKeys = Object.keys(worksInfo);\nvar DEFAULT_ACTIVE_KEY = worksKeys[0];\nvar tabHeadInfo = worksKeys.map(function (key) {\n  var _worksInfo$key = worksInfo[key],\n      data = _worksInfo$key.data,\n      rest = _objectWithoutProperties(_worksInfo$key, [\"data\"]);\n\n  return _objectSpread({\n    key: key,\n    num: data.length\n  }, rest);\n});\n\nvar TabsWorksHead = function TabsWorksHead(_ref) {\n  var onSwitchTab = _ref.onSwitchTab,\n      style = _ref.style;\n\n  var _useContext = useContext(CtxStore),\n      store = _useContext.store;\n\n  var bodyStyle = store.bodyStyle;\n  var elTabs = useRef(null);\n\n  var _useState = useState(DEFAULT_ACTIVE_KEY),\n      activeKey = _useState[0],\n      setActiveKey = _useState[1];\n\n  var _useState2 = useState({\n    width: 0,\n    offsetX: 0\n  }),\n      activeInfo = _useState2[0],\n      setActiveInfo = _useState2[1];\n\n  var width = activeInfo.width,\n      offsetX = activeInfo.offsetX;\n\n  var onSelected = function onSelected(key) {\n    return function (e) {\n      e.preventDefault();\n      setActiveKey(key);\n      var _e$currentTarget = e.currentTarget,\n          offsetWidth = _e$currentTarget.offsetWidth,\n          offsetLeft = _e$currentTarget.offsetLeft;\n      setActiveInfo(function (v) {\n        return _objectSpread({}, v, {\n          width: offsetWidth,\n          offsetX: offsetLeft\n        });\n      });\n      onSwitchTab && onSwitchTab(key);\n    };\n  };\n\n  var initialTabsActive = function initialTabsActive() {\n    var current = elTabs.current;\n    var index = findDataIndex({\n      data: tabHeadInfo,\n      key: 'key',\n      target: activeKey\n    });\n    if (Object.is(index, -1)) return;\n    var node = current === null || current === void 0 ? void 0 : current.querySelectorAll('a')[index];\n    node === null || node === void 0 ? void 0 : node.click();\n  };\n\n  useEffect(initialTabsActive, []);\n  return __jsx(Sticky, null, function (_ref2) {\n    var style = _ref2.style,\n        isSticky = _ref2.isSticky;\n    return __jsx(\"div\", {\n      style: _objectSpread({}, style, {}, isSticky && _objectSpread({\n        boxShadow: 'rgb(0, 0, 0,.24) 0px 0px 4px'\n      }, bodyStyle)),\n      className: \"tac tabs-wrapper z-1\"\n    }, __jsx(\"div\", {\n      ref: elTabs,\n      className: \"inline-block pos-rel font-size-sm\"\n    }, tabHeadInfo.map(function (_ref3) {\n      var title = _ref3.title,\n          num = _ref3.num,\n          key = _ref3.key,\n          isHot = _ref3.isHot;\n      return __jsx(\"a\", {\n        key: key,\n        href: \"#\",\n        onClick: onSelected(key),\n        className: classNames('m-l-r-xl p-b-xxs', {\n          'color-primary active': Object.is(activeKey, key)\n        })\n      }, title, \" (\", ' ', __jsx(\"span\", {\n        className: \"font-family-georgia font-size-xxl\"\n      }, num, isHot && __jsx(\"span\", {\n        className: \"hot pos-rel\"\n      }, __jsx(\"em\", {\n        style: {\n          top: 4\n        }\n      }))), ' ', \")\");\n    }), __jsx(\"div\", {\n      style: {\n        width: width,\n        transform: \"translateX(\".concat(offsetX, \"px)\"),\n        transition: '.5s'\n      },\n      className: \"tabs-active\"\n    })));\n  });\n};\n\nvar WorkItem = function WorkItem(_ref4) {\n  var _ref4$item = _ref4.item,\n      item = _ref4$item === void 0 ? {} : _ref4$item,\n      onVisitContent = _ref4.onVisitContent,\n      onMouseIn = _ref4.onMouseIn,\n      onMouseOut = _ref4.onMouseOut;\n  var category = item.category,\n      desc = item.desc,\n      qrcodeImg = item.qrcodeImg,\n      title = item.title,\n      searchKeyword = item.searchKeyword,\n      visible = item.visible,\n      links = item.links;\n\n  var visitLinksProps = _objectSpread({\n    href: links || '#',\n    title: title\n  }, links ? {\n    target: '_blank'\n  } : {\n    onClick: onVisitContent\n  });\n\n  return __jsx(\"figure\", {\n    className: \"item\"\n  }, __jsx(\"a\", _extends({\n    className: \"block\"\n  }, visitLinksProps), __jsx(Lazyload, {\n    once: true,\n    throttle: 200,\n    height: 400,\n    placeholder: __jsx(\"img\", {\n      // className=\"w-h-100\" //勿设置\n      src: \"/static/placeholder-pic.png\",\n      alt: \"\"\n    })\n  }, __jsx(\"img\", {\n    className: \"photo\" // src={require('@images/' + item.imgSrc)}\n    ,\n    src: \"/static/\".concat(item.imgSrc),\n    alt: title\n  })), __jsx(\"div\", {\n    className: \"mouse-move-layer t-0\",\n    onMouseEnter: function onMouseEnter(e) {\n      return onMouseIn && onMouseIn(e, true);\n    },\n    onMouseLeave: function onMouseLeave(e) {\n      return onMouseOut && onMouseOut(e, true);\n    }\n  }), __jsx(\"div\", {\n    className: \"mouse-move-layer b-0\",\n    onMouseEnter: onMouseIn,\n    onMouseLeave: onMouseOut\n  })), __jsx(\"figcaption\", {\n    className: \"content\"\n  }, __jsx(\"h3\", null, title), __jsx(\"p\", null, desc), __jsx(\"div\", {\n    \"layout-align\": \"space-between center\"\n  }, __jsx(\"span\", {\n    className: \"category\"\n  }, category), __jsx(\"a\", _extends({\n    className: \"color-primary bdb-line-primary\"\n  }, visitLinksProps), __jsx(\"span\", {\n    className: \"vam\"\n  }, \"\\u8BBF\\u95EE\\u94FE\\u63A5\"), __jsx(SvgIcon, {\n    className: \"m-l-xs\",\n    component: SvgPaperPlane\n  })))), (qrcodeImg || searchKeyword) && __jsx(\"div\", {\n    style: {\n      display: visible ? 'block' : 'none'\n    },\n    className: \"mask-root pos-abs t-0 w-h-100\"\n  }, __jsx(\"div\", {\n    onClick: onVisitContent,\n    className: \"mask-layer w-h-100\"\n  }), qrcodeImg ? __jsx(\"img\", {\n    className: \"pos-abs tblr-0 m-auto\" // src={require(`@images/${qrcodeImg}`)}\n    ,\n    src: \"/static/\".concat(qrcodeImg),\n    alt: \"\"\n  }) : __jsx(\"div\", {\n    className: \"app-dec pos-abs color-white font-size-md\"\n  }, \"\\u8FDB\\u5165\\u5FAE\\u4FE1APP-\", '>', \"\\u70B9\\u51FB\\u53D1\\u73B0-\", '>', \"\\u9009\\u62E9\\u5C0F\\u7A0B\\u5E8F\\u641C-\", '>', \"\\u7D22 \\\"\", __jsx(\"span\", {\n    className: \"color-primary\"\n  }, \" \", searchKeyword, \" \"), \"\\\" \\u8BBF\\u95EE\")));\n};\n\nvar TabsWorksContent = function TabsWorksContent(_ref5) {\n  var _ref5$activeKey = _ref5.activeKey,\n      activeKey = _ref5$activeKey === void 0 ? '' : _ref5$activeKey;\n\n  var _useState3 = useState({\n    data: [],\n    hasNextPage: true,\n    loading: true\n  }),\n      info = _useState3[0],\n      setInfo = _useState3[1];\n\n  var data = info.data,\n      hasNextPage = info.hasNextPage,\n      loading = info.loading;\n\n  var onVisitContent = function onVisitContent(item) {\n    return function (e) {\n      setInfo(function (v) {\n        return _objectSpread({}, v, {\n          data: data.map(function (v) {\n            return _objectSpread({}, v, {}, Object.is(v.imgSrc, item.imgSrc) && {\n              visible: !v.visible\n            });\n          })\n        });\n      });\n      e.preventDefault();\n    };\n  };\n\n  var onMouseIn = function onMouseIn(e, isTop) {\n    var currentDom = e.currentTarget;\n    var parentDom = currentDom.parentNode;\n    var domImg = parentDom === null || parentDom === void 0 ? void 0 : parentDom.querySelector('.photo');\n    if (!domImg) return; // const { clientY } = e\n    // const { top, height } = currentDom.getBoundingClientRect()\n    // const halfHeight = height / 2\n    // const isTop = halfHeight > clientY - top //移入位置\n\n    var marginTopVal = parseFloat(getStyle(domImg).marginTop);\n    var hiddenHeight = (domImg.getBoundingClientRect().height || 0) - parseInt(getStyle(parentDom).maxHeight); //计算隐藏的高度\n\n    var moveTime = 150; //值越大、移动越快，反之\n\n    var moveSpeed = hiddenHeight / moveTime;\n    var restMovDistance = (isTop ? -marginTopVal : hiddenHeight + marginTopVal) * moveSpeed; //移动的距离\n\n    var time = (restMovDistance / hiddenHeight).toFixed(2); //剩余距离需要移动的时间\n\n    domImg.style.cssText = \"margin-top:\".concat(isTop ? 0 : -hiddenHeight, \"px;transition:margin-top \").concat(time, \"s linear;\");\n  };\n\n  var onMouseOut = function onMouseOut(e) {\n    var _currentDom$parentNod;\n\n    var currentDom = e.currentTarget;\n    var domImg = (_currentDom$parentNod = currentDom.parentNode) === null || _currentDom$parentNod === void 0 ? void 0 : _currentDom$parentNod.querySelector('.photo');\n    if (!domImg) return;\n    var marginTopVal = getStyle(domImg).marginTop;\n    domImg.style.cssText = \"margin-top:\".concat(marginTopVal, \";\");\n  };\n\n  var fetchData = function fetchData() {\n    var pageIndex = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;\n    var result = worksInfo[activeKey];\n    if (!result) return;\n    paginationAfterData({\n      query: {\n        pageIndex: pageIndex\n      },\n      data: result.data\n    }).then(function (res) {\n      var list = res.data;\n      var isFirstPage = Object.is(pageIndex, 1);\n      setInfo(function (v) {\n        return _objectSpread({}, v, {}, res, {\n          data: isFirstPage ? list : [].concat(_toConsumableArray(data), _toConsumableArray(list))\n        });\n      });\n    })[\"catch\"](function () {\n      setInfo(function (v) {\n        return _objectSpread({}, v, {\n          hasNextPage: false\n        });\n      });\n    })[\"finally\"](function () {\n      setInfo(function (v) {\n        return _objectSpread({}, v, {\n          loading: false\n        });\n      });\n    });\n  };\n\n  useEffect(function () {\n    setInfo(function (v) {\n      return _objectSpread({}, v, {\n        hasNextPage: true,\n        loading: true\n      });\n    });\n    fetchData();\n  }, [activeKey]);\n\n  var loadFunc = function loadFunc(page) {\n    if (!hasNextPage) return;\n    fetchData(page);\n  };\n\n  return __jsx(\"div\", {\n    className: works_list\n  }, loading ? __jsx(Loading, {\n    className: \"tac p-b-xxl\"\n  }) : __jsx(InfiniteScroll, {\n    pageStart: 0,\n    loadMore: loadFunc,\n    hasMore: hasNextPage,\n    loader: __jsx(Loading, {\n      key: \"0\",\n      className: \"tac p-b-xxl\"\n    })\n  }, data.map(function (item) {\n    var imgSrc = item.imgSrc;\n    return __jsx(WorkItem, {\n      key: imgSrc,\n      onVisitContent: onVisitContent(item),\n      onMouseIn: onMouseIn,\n      onMouseOut: onMouseOut,\n      item: item\n    });\n  }), !hasNextPage && isValidArray(data) && data.length >= DEFAULT_PAGE_SIZE && __jsx(\"div\", {\n    className: \"tac p-b-xxl\"\n  }, \"\\u6CA1\\u6709\\u66F4\\u591A\\u4E86\\u2299\\uFE4F\\u2299\")));\n};\n\nvar Works = function Works() {\n  var _useState4 = useState(''),\n      activeKey = _useState4[0],\n      setActiveKey = _useState4[1];\n\n  return __jsx(\"section\", {\n    className: works_wrapper\n  }, __jsx(Banner, null), __jsx(LayoutMain, {\n    pageTitleProps: {\n      zhName: __jsx(React.Fragment, null, __jsx(\"span\", {\n        className: \"font-family-georgia\"\n      }, \"6\"), \"\\u4E2A\\u4F5C\\u54C1\"),\n      enName: 'more than 40 works'\n    }\n  }, __jsx(StickyContainer, null, __jsx(TabsWorksHead, {\n    onSwitchTab: function onSwitchTab(key) {\n      return setActiveKey(key);\n    }\n  }), activeKey && __jsx(TabsWorksContent, {\n    activeKey: activeKey\n  }))));\n};\n\nexport default Works;","map":null,"metadata":{},"sourceType":"module"}