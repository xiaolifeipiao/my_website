{"ast":null,"code":"var __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React, { useState, useEffect, useRef, useContext, useCallback } from 'react';\nimport Link from 'next/link';\nimport { useRouter } from 'next/router';\nimport Router from 'next/router';\nimport classNames from 'classnames';\nimport { debounce } from 'throttle-debounce';\nimport { isString, isBoolean, isUndefined } from 'util';\nimport styles from '@styles/sass/frame/menus.module.scss';\nimport { isSmallScreen } from '@scripts/helper';\nimport { APP_CONFIG, THEME_COLOR_LIST, DEFAULT_THEME_COLOR, BACKGROUND_COLOR_LIST, DEFAULT_BACKGROUND_COLOR, DEFAULT_DARK_COLOR, DEFAULT_LOVEEYE_COLOR } from '@scripts/constant';\nimport { globalSelf, generateNumList, setStorage, getStorage } from '@scripts/utils';\nimport { CtxStore } from '../context';\nimport Menubar from './Menubar';\nimport { SvgIcon, Switch } from '../common';\nimport { ReactComponent as SvgCheck } from '@fonts/svg/menu/check.svg';\nimport { ReactComponent as SvgSetting } from '@fonts/svg/merge/setting.svg';\nimport { ReactComponent as SvgClose } from '@fonts/svg/shared/close.svg';\nimport { useIsVisible } from '../hooks';\nconst {\n  side_wrapper,\n  logo,\n  theme_wrapper,\n  head_menu\n} = styles;\nconst {\n  name,\n  logo: logoPic\n} = globalSelf.g_config;\nconst themeNums = generateNumList(5);\nconst toggleBtnNums = generateNumList(3);\n\nconst mediaScheme = () => window.matchMedia('(prefers-color-scheme: dark)');\n\nconst SideLogo = () => {\n  return __jsx(Link, {\n    href: \"/\"\n  }, __jsx(\"a\", {\n    className: `tac pos-rel block ${logo}`,\n    title: name\n  }, __jsx(\"div\", {\n    className: \"round bdr-half\"\n  }, __jsx(\"i\", {\n    className: \"icon-circle pos-abs t-0\"\n  })), __jsx(\"h2\", {\n    className: \"pos-abs r-m-p color-white bg-color-primary\"\n  }, __jsx(\"span\", {\n    className: \"vam\"\n  }, \"\\u5C45\\u5C45\", __jsx(\"br\", null), \"\\u8D1D\\u8D1D\")), __jsx(\"img\", {\n    className: \"pos-abs vam\",\n    src: logoPic,\n    alt: name\n  })));\n};\n\nconst BackgroundOrColorTheme = () => {\n  const {\n    0: isFollowSystem,\n    1: setIsFollowSystem\n  } = useState(false);\n  const keepData = useRef({\n    isFollowSystem\n  });\n  const {\n    0: activeKey,\n    1: setActiveKey\n  } = useState();\n  const {\n    0: currentColor,\n    1: setCurrentColor\n  } = useState(DEFAULT_THEME_COLOR);\n  const {\n    dispatch\n  } = useContext(CtxStore);\n  const [, ...rest] = BACKGROUND_COLOR_LIST;\n\n  const onSwitchTheme = ({\n    backgroundKey,\n    isColor = true,\n    isMemory = true,\n    isEqualReturn = true\n  }) => {\n    if (isUndefined(backgroundKey)) return;\n\n    try {\n      const isEqual = isEqualReturn && Object.is(activeKey, backgroundKey);\n      const [isDefaultColor, isDarkColor, isLoveEyeColor] = isColor && !isEqual ? [Object.is(DEFAULT_BACKGROUND_COLOR, backgroundKey), rest.includes(backgroundKey), Object.is(backgroundKey, DEFAULT_LOVEEYE_COLOR)] : [];\n      const isEmpty = isEqual || isDefaultColor;\n      const bodyStyle = isEmpty ? {} : {\n        background: isColor ? backgroundKey : `url(${require(`@images/icons/icon-bg${backgroundKey}.png`)})`\n      };\n      const docStyle = document.documentElement.style;\n      docStyle.setProperty('--color-default-gray', isLoveEyeColor ? DEFAULT_DARK_COLOR : isDarkColor ? '#fff' : '#aaa');\n      docStyle.setProperty('--color-lighten-gray', isLoveEyeColor ? '#d2d2d2' : isDarkColor ? '#676767' : '#dadada');\n      setActiveKey(isEqual ? void 0 : backgroundKey);\n      isMemory && setStorage(APP_CONFIG, {\n        backgroundKey: isEmpty ? void 0 : backgroundKey\n      });\n      dispatch({\n        type: 'global',\n        payload: {\n          bodyStyle\n        }\n      });\n    } catch (error) {\n      console.warn(`引入背景图片失败`);\n    }\n  };\n\n  const onSwitchColor = color => {\n    if (Object.is(currentColor, color)) return;\n    const docStyle = document.documentElement.style;\n    docStyle.setProperty('--color-primary', color);\n    setCurrentColor(color);\n    setStorage(APP_CONFIG, {\n      themeColor: color\n    });\n  };\n\n  const onCustomColorChange = useCallback(debounce(1000, onSwitchColor), []);\n\n  const setThemeBackground = () => {\n    const {\n      backgroundKey\n    } = getStorage(APP_CONFIG);\n    onSwitchTheme({\n      backgroundKey,\n      isColor: isString(backgroundKey) && backgroundKey.includes('#'),\n      isEqualReturn: false\n    });\n  };\n\n  const handleSwitchTheme = e => {\n    if (!keepData.current.isFollowSystem) return;\n    const isDarkMode = e ? e.matches : mediaScheme().matches;\n\n    if (isDarkMode) {\n      return onSwitchTheme({\n        backgroundKey: DEFAULT_DARK_COLOR,\n        isMemory: false,\n        isEqualReturn: false\n      });\n    }\n\n    return onSwitchTheme({\n      backgroundKey: DEFAULT_BACKGROUND_COLOR,\n      isMemory: false\n    });\n  };\n\n  const changeIsFollowSystem = isOpen => {\n    setIsFollowSystem(isOpen);\n    keepData.current.isFollowSystem = isOpen;\n  };\n\n  const onFollowSystem = checked => {\n    setStorage(APP_CONFIG, {\n      isFollowSystem: checked\n    });\n    changeIsFollowSystem(checked);\n    checked ? handleSwitchTheme() : setThemeBackground();\n  };\n\n  useEffect(() => {\n    const {\n      themeColor,\n      isFollowSystem: storeIsFollowSystem\n    } = getStorage(APP_CONFIG);\n    themeColor && onSwitchColor(themeColor);\n\n    if (isBoolean(storeIsFollowSystem) && storeIsFollowSystem) {\n      changeIsFollowSystem(true);\n      return handleSwitchTheme();\n    }\n\n    setThemeBackground();\n  }, []);\n  useEffect(() => {\n    const media = mediaScheme();\n    media.addListener ? media.addListener(handleSwitchTheme) : media.addEventListener('change', handleSwitchTheme);\n    return () => {\n      ;\n      (media.removeListener || media.removeListener)(handleSwitchTheme);\n    };\n  }, []);\n  return __jsx(\"section\", {\n    className: `${theme_wrapper} tac p-b-xl`\n  }, __jsx(\"h4\", {\n    className: \"font-weight-normal r-m-p\"\n  }, \"\\u80CC\\u666F\"), __jsx(\"div\", {\n    className: \"m-t-xl\"\n  }, BACKGROUND_COLOR_LIST.map(color => {\n    return __jsx(\"button\", {\n      className: classNames('pos-rel', {\n        active: !isFollowSystem && Object.is(activeKey, color)\n      }),\n      disabled: isFollowSystem,\n      style: {\n        width: 42,\n        height: 32,\n        backgroundColor: color\n      },\n      onClick: () => onSwitchTheme({\n        backgroundKey: color\n      }),\n      key: color\n    }, __jsx(SvgIcon, {\n      className: \"pos-abs tblr-0 m-auto hide color-primary\",\n      component: SvgCheck\n    }));\n  }), themeNums.slice(-(themeNums.length - 2)).map(item => {\n    const index = ++item;\n    return __jsx(\"button\", _extends({\n      className: classNames('pos-rel', {\n        active: !isFollowSystem && Object.is(activeKey, index)\n      }),\n      disabled: isFollowSystem\n    }, activeKey && {\n      style: {\n        boxShadow: '0px 0px 5px var(--color-lighten-gray)'\n      }\n    }, {\n      onClick: () => onSwitchTheme({\n        backgroundKey: index,\n        isColor: false\n      }),\n      key: index\n    }), __jsx(\"i\", {\n      className: `icon-bg${index}`\n    }), __jsx(SvgIcon, {\n      className: \"pos-abs tblr-0 m-auto hide color-primary\",\n      component: SvgCheck\n    }));\n  }), __jsx(\"h4\", {\n    className: \"font-weight-normal r-m-p m-t-b-xl\"\n  }, \"\\u8DDF\\u968F\\u7CFB\\u7EDF:\", __jsx(\"span\", {\n    className: \"m-l-xxs\"\n  }, __jsx(Switch, {\n    checked: isFollowSystem,\n    checkedChildren: \"\\u5F00\",\n    uncheckedChildren: \"\\u5173\",\n    onChange: onFollowSystem\n  })))), __jsx(\"h4\", {\n    className: \"font-weight-normal r-m-p m-b-xl\"\n  }, \"\\u989C\\u8272\"), THEME_COLOR_LIST.map((color, index) => {\n    const isLast = Object.is(THEME_COLOR_LIST.length - 1, index);\n    return __jsx(\"button\", _extends({\n      className: classNames('pos-rel', {\n        active: Object.is(currentColor, color)\n      }),\n      style: {\n        width: 42,\n        height: 32,\n        backgroundColor: color\n      }\n    }, !isLast && {\n      onClick: () => onSwitchColor(color)\n    }, {\n      key: color\n    }), __jsx(SvgIcon, {\n      className: \"pos-abs tblr-0 m-auto hide color-white\",\n      component: SvgCheck\n    }), isLast && __jsx(React.Fragment, null, __jsx(\"input\", {\n      className: \"input-custom-color pos-abs tblr-0 w-h-100 cursign\",\n      onChange: ({\n        target: {\n          value\n        }\n      }) => onCustomColorChange(value),\n      type: \"color\"\n    }), __jsx(\"span\", {\n      className: \"font-size-xs color-white\"\n    }, \"\\u81EA\\u5B9A\\u4E49\")));\n  }));\n};\n\nconst Sidebar = () => {\n  const {\n    store\n  } = useContext(CtxStore);\n  const {\n    bodyStyle\n  } = store;\n  const keepData = useRef({\n    pathname: ''\n  });\n  const {\n    pathname\n  } = useRouter();\n  const {\n    0: toogle,\n    1: setToogle\n  } = useState(false);\n  const {\n    isShow,\n    toggleContent\n  } = useIsVisible();\n  useEffect(() => {\n    if (!isSmallScreen()) return;\n\n    const handleRouteChange = url => {\n      const {\n        pathname\n      } = keepData.current;\n\n      if (!Object.is(url, pathname)) {\n        setToogle(false);\n      }\n    };\n\n    const {\n      events\n    } = Router;\n    events.on('routeChangeStart', handleRouteChange);\n    return () => {\n      events.off('routeChangeStart', handleRouteChange);\n    };\n  }, []);\n  useEffect(() => {\n    keepData.current.pathname = pathname;\n  }, [pathname]);\n  return __jsx(React.Fragment, null, __jsx(\"div\", {\n    className: `pos-fix tar z-3 t-l-0 w-100 bg-color-primary ${head_menu}`\n  }, __jsx(\"button\", {\n    className: classNames(`bg-color-transparent vam`, {\n      active: toogle\n    }),\n    onClick: () => setToogle(!toogle)\n  }, toggleBtnNums.map(num => __jsx(\"span\", {\n    key: num\n  }, __jsx(\"i\", null))))), __jsx(\"section\", {\n    style: _objectSpread({}, toogle && {\n      left: 0\n    }, {\n      zIndex: 13\n    }, bodyStyle),\n    className: classNames(`pos-fix t-l-0 h-100 bg-color-white ${side_wrapper}`, {\n      active: toogle\n    })\n  }, __jsx(SideLogo, null), __jsx(Menubar, null), __jsx(\"div\", {\n    className: \"pos-rel\"\n  }, __jsx(\"button\", {\n    onClick: toggleContent,\n    className: classNames('btn-theme-setting pos-abs bg-color-primary color-white p-tblr-xxs font-size-lg bd-none z-1')\n  }, __jsx(SvgIcon, {\n    component: isShow ? SvgClose : SvgSetting\n  })), __jsx(\"div\", {\n    className: \"pos-abs tblr-0 m-auto\",\n    style: {\n      transform: `translateX(${isShow ? 0 : '-100%'})`,\n      transition: '.5s'\n    }\n  }, __jsx(BackgroundOrColorTheme, null)))));\n};\n\nexport default Sidebar;","map":null,"metadata":{},"sourceType":"module"}