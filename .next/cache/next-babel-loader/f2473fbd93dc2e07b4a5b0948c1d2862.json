{"ast":null,"code":"var __jsx = React.createElement;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React, { useState, useEffect, useRef, useContext } from 'react';\nimport classNames from 'classnames';\nimport Lazyload from 'react-lazyload';\nimport { StickyContainer, Sticky } from '@components/react-sticky';\nimport InfiniteScroll from 'react-infinite-scroller';\nimport styles from '@styles/sass/page/works.module.scss';\nimport { findDataIndex, getStyle, paginationAfterData, isValidArray } from '@scripts/utils';\nimport { DEFAULT_PAGE_SIZE } from '@scripts/constant';\nimport { worksInfo } from '@store/mock';\nimport { CtxStore } from '../components/context';\nimport { Banner, SvgIcon, Loading } from '@components/common';\nimport { LayoutMain } from '@components/layout';\nimport { ReactComponent as SvgPaperPlane } from '@fonts/svg/merge/paper-plane.svg';\nconst {\n  works_wrapper,\n  works_list\n} = styles;\nconst worksKeys = Object.keys(worksInfo);\nconst DEFAULT_ACTIVE_KEY = worksKeys[0];\nconst tabHeadInfo = worksKeys.map(key => {\n  const _worksInfo$key = worksInfo[key],\n        {\n    data\n  } = _worksInfo$key,\n        rest = _objectWithoutProperties(_worksInfo$key, [\"data\"]);\n\n  return _objectSpread({\n    key,\n    num: data.length\n  }, rest);\n});\n\nconst TabsWorksHead = ({\n  onSwitchTab,\n  style\n}) => {\n  const {\n    store\n  } = useContext(CtxStore);\n  const {\n    bodyStyle\n  } = store;\n  const elTabs = useRef(null);\n  const {\n    0: activeKey,\n    1: setActiveKey\n  } = useState(DEFAULT_ACTIVE_KEY);\n  const {\n    0: activeInfo,\n    1: setActiveInfo\n  } = useState({\n    width: 0,\n    offsetX: 0\n  });\n  const {\n    width,\n    offsetX\n  } = activeInfo;\n\n  const onSelected = key => {\n    return e => {\n      e.preventDefault();\n      setActiveKey(key);\n      const {\n        offsetWidth,\n        offsetLeft\n      } = e.currentTarget;\n      setActiveInfo(v => _objectSpread({}, v, {\n        width: offsetWidth,\n        offsetX: offsetLeft\n      }));\n      onSwitchTab && onSwitchTab(key);\n    };\n  };\n\n  const initialTabsActive = () => {\n    const {\n      current\n    } = elTabs;\n    const index = findDataIndex({\n      data: tabHeadInfo,\n      key: 'key',\n      target: activeKey\n    });\n    if (Object.is(index, -1)) return;\n    const node = current === null || current === void 0 ? void 0 : current.querySelectorAll('a')[index];\n    node === null || node === void 0 ? void 0 : node.click();\n  };\n\n  useEffect(initialTabsActive, []);\n  return __jsx(Sticky, null, ({\n    style,\n    isSticky\n  }) => {\n    return __jsx(\"div\", {\n      style: _objectSpread({}, style, {}, isSticky && _objectSpread({\n        boxShadow: 'rgb(0, 0, 0,.24) 0px 0px 4px'\n      }, bodyStyle)),\n      className: \"tac tabs-wrapper z-1\"\n    }, __jsx(\"div\", {\n      ref: elTabs,\n      className: \"inline-block pos-rel font-size-sm\"\n    }, tabHeadInfo.map(({\n      title,\n      num,\n      key,\n      isHot\n    }) => __jsx(\"a\", {\n      key: key,\n      href: \"#\",\n      onClick: onSelected(key),\n      className: classNames('m-l-r-xl p-b-xxs', {\n        'color-primary active': Object.is(activeKey, key)\n      })\n    }, title, \" (\", ' ', __jsx(\"span\", {\n      className: \"font-family-georgia font-size-xxl\"\n    }, num, isHot && __jsx(\"span\", {\n      className: \"hot pos-rel\"\n    }, __jsx(\"em\", {\n      style: {\n        top: 4\n      }\n    }))), ' ', \")\")), __jsx(\"div\", {\n      style: {\n        width: width,\n        transform: `translateX(${offsetX}px)`,\n        transition: '.5s'\n      },\n      className: \"tabs-active\"\n    })));\n  });\n};\n\nconst WorkItem = ({\n  item = {},\n  onVisitContent,\n  onMouseIn,\n  onMouseOut\n}) => {\n  const {\n    category,\n    desc,\n    qrcodeImg,\n    title,\n    searchKeyword,\n    visible,\n    links\n  } = item;\n\n  const visitLinksProps = _objectSpread({\n    href: links || '#',\n    title\n  }, links ? {\n    target: '_blank'\n  } : {\n    onClick: onVisitContent\n  });\n\n  return __jsx(\"figure\", {\n    className: \"item\"\n  }, __jsx(\"a\", _extends({\n    className: \"block\"\n  }, visitLinksProps), __jsx(Lazyload, {\n    once: true,\n    throttle: 200,\n    height: 400,\n    placeholder: __jsx(\"img\", {\n      // className=\"w-h-100\" //勿设置\n      src: `/static/placeholder-pic.png`,\n      alt: \"\"\n    })\n  }, __jsx(\"img\", {\n    className: \"photo\" // src={require('@images/' + item.imgSrc)}\n    ,\n    src: `/static/${item.imgSrc}`,\n    alt: title\n  })), __jsx(\"div\", {\n    className: \"mouse-move-layer t-0\",\n    onMouseEnter: e => onMouseIn && onMouseIn(e, true),\n    onMouseLeave: e => onMouseOut && onMouseOut(e, true)\n  }), __jsx(\"div\", {\n    className: \"mouse-move-layer b-0\",\n    onMouseEnter: onMouseIn,\n    onMouseLeave: onMouseOut\n  })), __jsx(\"figcaption\", {\n    className: \"content\"\n  }, __jsx(\"h3\", null, title), __jsx(\"p\", null, desc), __jsx(\"div\", {\n    \"layout-align\": \"space-between center\"\n  }, __jsx(\"span\", {\n    className: \"category\"\n  }, category), __jsx(\"a\", _extends({\n    className: \"color-primary bdb-line-primary\"\n  }, visitLinksProps), __jsx(\"span\", {\n    className: \"vam\"\n  }, \"\\u8BBF\\u95EE\\u94FE\\u63A5\"), __jsx(SvgIcon, {\n    className: \"m-l-xs\",\n    component: SvgPaperPlane\n  })))), (qrcodeImg || searchKeyword) && __jsx(\"div\", {\n    style: {\n      display: visible ? 'block' : 'none'\n    },\n    className: \"mask-root pos-abs t-0 w-h-100\"\n  }, __jsx(\"div\", {\n    onClick: onVisitContent,\n    className: \"mask-layer w-h-100\"\n  }), qrcodeImg ? __jsx(\"img\", {\n    className: \"pos-abs tblr-0 m-auto\" // src={require(`@images/${qrcodeImg}`)}\n    ,\n    src: `/static/${qrcodeImg}`,\n    alt: \"\"\n  }) : __jsx(\"div\", {\n    className: \"app-dec pos-abs color-white font-size-md\"\n  }, \"\\u8FDB\\u5165\\u5FAE\\u4FE1APP-\", '>', \"\\u70B9\\u51FB\\u53D1\\u73B0-\", '>', \"\\u9009\\u62E9\\u5C0F\\u7A0B\\u5E8F\\u641C-\", '>', \"\\u7D22 \\\"\", __jsx(\"span\", {\n    className: \"color-primary\"\n  }, \" \", searchKeyword, \" \"), \"\\\" \\u8BBF\\u95EE\")));\n};\n\nconst TabsWorksContent = ({\n  activeKey = ''\n}) => {\n  const {\n    0: info,\n    1: setInfo\n  } = useState({\n    data: [],\n    hasNextPage: true,\n    loading: true\n  });\n  const {\n    data,\n    hasNextPage,\n    loading\n  } = info;\n\n  const onVisitContent = item => {\n    return e => {\n      setInfo(v => _objectSpread({}, v, {\n        data: data.map(v => _objectSpread({}, v, {}, Object.is(v.imgSrc, item.imgSrc) && {\n          visible: !v.visible\n        }))\n      }));\n      e.preventDefault();\n    };\n  };\n\n  const onMouseIn = (e, isTop) => {\n    const currentDom = e.currentTarget;\n    const parentDom = currentDom.parentNode;\n    const domImg = parentDom === null || parentDom === void 0 ? void 0 : parentDom.querySelector('.photo');\n    if (!domImg) return; // const { clientY } = e\n    // const { top, height } = currentDom.getBoundingClientRect()\n    // const halfHeight = height / 2\n    // const isTop = halfHeight > clientY - top //移入位置\n\n    const marginTopVal = parseFloat(getStyle(domImg).marginTop);\n    const hiddenHeight = (domImg.getBoundingClientRect().height || 0) - parseInt(getStyle(parentDom).maxHeight); //计算隐藏的高度\n\n    const moveTime = 150; //值越大、移动越快，反之\n\n    const moveSpeed = hiddenHeight / moveTime;\n    const restMovDistance = (isTop ? -marginTopVal : hiddenHeight + marginTopVal) * moveSpeed; //移动的距离\n\n    const time = (restMovDistance / hiddenHeight).toFixed(2); //剩余距离需要移动的时间\n\n    domImg.style.cssText = `margin-top:${isTop ? 0 : -hiddenHeight}px;transition:margin-top ${time}s linear;`;\n  };\n\n  const onMouseOut = e => {\n    var _currentDom$parentNod;\n\n    const currentDom = e.currentTarget;\n    const domImg = (_currentDom$parentNod = currentDom.parentNode) === null || _currentDom$parentNod === void 0 ? void 0 : _currentDom$parentNod.querySelector('.photo');\n    if (!domImg) return;\n    const marginTopVal = getStyle(domImg).marginTop;\n    domImg.style.cssText = `margin-top:${marginTopVal};`;\n  };\n\n  const fetchData = (pageIndex = 1) => {\n    const result = worksInfo[activeKey];\n    if (!result) return;\n    paginationAfterData({\n      query: {\n        pageIndex\n      },\n      data: result.data\n    }).then(res => {\n      const {\n        data: list\n      } = res;\n      const isFirstPage = Object.is(pageIndex, 1);\n      setInfo(v => _objectSpread({}, v, {}, res, {\n        data: isFirstPage ? list : [...data, ...list]\n      }));\n    }).catch(() => {\n      setInfo(v => _objectSpread({}, v, {\n        hasNextPage: false\n      }));\n    }).finally(() => {\n      setInfo(v => _objectSpread({}, v, {\n        loading: false\n      }));\n    });\n  };\n\n  useEffect(() => {\n    setInfo(v => _objectSpread({}, v, {\n      hasNextPage: true,\n      loading: true\n    }));\n    fetchData();\n  }, [activeKey]);\n\n  const loadFunc = page => {\n    if (!hasNextPage) return;\n    fetchData(page);\n  };\n\n  return __jsx(\"div\", {\n    className: works_list\n  }, loading ? __jsx(Loading, {\n    className: \"tac p-b-xxl\"\n  }) : __jsx(InfiniteScroll, {\n    pageStart: 0,\n    loadMore: loadFunc,\n    hasMore: hasNextPage,\n    loader: __jsx(Loading, {\n      key: \"0\",\n      className: \"tac p-b-xxl\"\n    })\n  }, data.map(item => {\n    const {\n      imgSrc\n    } = item;\n    return __jsx(WorkItem, {\n      key: imgSrc,\n      onVisitContent: onVisitContent(item),\n      onMouseIn: onMouseIn,\n      onMouseOut: onMouseOut,\n      item: item\n    });\n  }), !hasNextPage && isValidArray(data) && data.length >= DEFAULT_PAGE_SIZE && __jsx(\"div\", {\n    className: \"tac p-b-xxl\"\n  }, \"\\u6CA1\\u6709\\u66F4\\u591A\\u4E86\\u2299\\uFE4F\\u2299\")));\n};\n\nconst Works = () => {\n  const {\n    0: activeKey,\n    1: setActiveKey\n  } = useState('');\n  return __jsx(\"section\", {\n    className: works_wrapper\n  }, __jsx(Banner, null), __jsx(LayoutMain, {\n    pageTitleProps: {\n      zhName: __jsx(React.Fragment, null, __jsx(\"span\", {\n        className: \"font-family-georgia\"\n      }, \"6\"), \"\\u4E2A\\u4F5C\\u54C1\"),\n      enName: 'more than 40 works'\n    }\n  }, __jsx(StickyContainer, null, __jsx(TabsWorksHead, {\n    onSwitchTab: key => setActiveKey(key)\n  }), activeKey && __jsx(TabsWorksContent, {\n    activeKey: activeKey\n  }))));\n};\n\nexport default Works;","map":null,"metadata":{},"sourceType":"module"}