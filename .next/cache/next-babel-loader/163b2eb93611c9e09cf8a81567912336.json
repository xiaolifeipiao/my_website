{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\n\nvar _this = this,\n    _jsxFileName = \"C:\\\\Users\\\\19215\\\\Desktop\\\\my_website\\\\src\\\\pages\\\\works.tsx\";\n\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useEffect, useRef, useContext } from 'react';\nimport classNames from 'classnames';\nimport Lazyload from 'react-lazyload';\nimport { StickyContainer, Sticky } from '@components/react-sticky';\nimport InfiniteScroll from 'react-infinite-scroller';\nimport styles from '@styles/sass/page/works.module.scss';\nimport { findDataIndex, getStyle, paginationAfterData, isValidArray } from '@scripts/utils';\nimport { DEFAULT_PAGE_SIZE } from '@scripts/constant';\nimport { worksInfo } from '@store/mock';\nimport { CtxStore } from '../components/context';\nimport { Banner, SvgIcon, Loading } from '@components/common';\nimport { LayoutMain } from '@components/layout';\nimport { ReactComponent as SvgPaperPlane } from '@fonts/svg/merge/paper-plane.svg';\nvar works_wrapper = styles.works_wrapper,\n    works_list = styles.works_list;\nvar worksKeys = Object.keys(worksInfo);\nvar DEFAULT_ACTIVE_KEY = worksKeys[0];\nvar tabHeadInfo = worksKeys.map(function (key) {\n  var _worksInfo$key = worksInfo[key],\n      data = _worksInfo$key.data,\n      rest = _objectWithoutProperties(_worksInfo$key, [\"data\"]);\n\n  return _objectSpread({\n    key: key,\n    num: data.length\n  }, rest);\n});\n\nvar TabsWorksHead = function TabsWorksHead(_ref) {\n  var onSwitchTab = _ref.onSwitchTab,\n      style = _ref.style;\n\n  var _useContext = useContext(CtxStore),\n      store = _useContext.store;\n\n  var bodyStyle = store.bodyStyle;\n  var elTabs = useRef(null);\n\n  var _useState = useState(DEFAULT_ACTIVE_KEY),\n      activeKey = _useState[0],\n      setActiveKey = _useState[1];\n\n  var _useState2 = useState({\n    width: 0,\n    offsetX: 0\n  }),\n      activeInfo = _useState2[0],\n      setActiveInfo = _useState2[1];\n\n  var width = activeInfo.width,\n      offsetX = activeInfo.offsetX;\n\n  var onSelected = function onSelected(key) {\n    return function (e) {\n      e.preventDefault();\n      setActiveKey(key);\n      var _e$currentTarget = e.currentTarget,\n          offsetWidth = _e$currentTarget.offsetWidth,\n          offsetLeft = _e$currentTarget.offsetLeft;\n      setActiveInfo(function (v) {\n        return _objectSpread({}, v, {\n          width: offsetWidth,\n          offsetX: offsetLeft\n        });\n      });\n      onSwitchTab && onSwitchTab(key);\n    };\n  };\n\n  var initialTabsActive = function initialTabsActive() {\n    var current = elTabs.current;\n    var index = findDataIndex({\n      data: tabHeadInfo,\n      key: 'key',\n      target: activeKey\n    });\n    if (Object.is(index, -1)) return;\n    var node = current === null || current === void 0 ? void 0 : current.querySelectorAll('a')[index];\n    node === null || node === void 0 ? void 0 : node.click();\n  };\n\n  useEffect(initialTabsActive, []);\n  return __jsx(Sticky, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 5\n    }\n  }, function (_ref2) {\n    var style = _ref2.style,\n        isSticky = _ref2.isSticky;\n    return __jsx(\"div\", {\n      style: _objectSpread({}, style, {}, isSticky && _objectSpread({\n        boxShadow: 'rgb(0, 0, 0,.24) 0px 0px 4px'\n      }, bodyStyle)),\n      className: \"tac tabs-wrapper z-1\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 11\n      }\n    }, __jsx(\"div\", {\n      ref: elTabs,\n      className: \"inline-block pos-rel font-size-sm\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 13\n      }\n    }, tabHeadInfo.map(function (_ref3) {\n      var title = _ref3.title,\n          num = _ref3.num,\n          key = _ref3.key,\n          isHot = _ref3.isHot;\n      return __jsx(\"a\", {\n        key: key,\n        href: \"#\",\n        onClick: onSelected(key),\n        className: classNames('m-l-r-xl p-b-xxs', {\n          'color-primary active': Object.is(activeKey, key)\n        }),\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 103,\n          columnNumber: 17\n        }\n      }, title, \" (\", ' ', __jsx(\"span\", {\n        className: \"font-family-georgia font-size-xxl\",\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 112,\n          columnNumber: 19\n        }\n      }, num, isHot && __jsx(\"span\", {\n        className: \"hot pos-rel\",\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 115,\n          columnNumber: 23\n        }\n      }, __jsx(\"em\", {\n        style: {\n          top: 4\n        },\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 116,\n          columnNumber: 25\n        }\n      }))), ' ', \")\");\n    }), __jsx(\"div\", {\n      style: {\n        width: width,\n        transform: \"translateX(\".concat(offsetX, \"px)\"),\n        transition: '.5s'\n      },\n      className: \"tabs-active\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 15\n      }\n    })));\n  });\n};\n\nvar WorkItem = function WorkItem(_ref4) {\n  var _ref4$item = _ref4.item,\n      item = _ref4$item === void 0 ? {} : _ref4$item,\n      onVisitContent = _ref4.onVisitContent,\n      onMouseIn = _ref4.onMouseIn,\n      onMouseOut = _ref4.onMouseOut;\n  var category = item.category,\n      desc = item.desc,\n      qrcodeImg = item.qrcodeImg,\n      title = item.title,\n      searchKeyword = item.searchKeyword,\n      visible = item.visible,\n      links = item.links;\n\n  var visitLinksProps = _objectSpread({\n    href: links || '#',\n    title: title\n  }, links ? {\n    target: '_blank'\n  } : {\n    onClick: onVisitContent\n  });\n\n  return __jsx(\"figure\", {\n    className: \"item\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 5\n    }\n  }, __jsx(\"a\", _extends({\n    className: \"block\"\n  }, visitLinksProps, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 7\n    }\n  }), __jsx(Lazyload, {\n    once: true,\n    throttle: 200,\n    height: 400,\n    placeholder: __jsx(\"img\", {\n      // className=\"w-h-100\" //勿设置\n      src: \"/static/placeholder-pic.png\",\n      alt: \"\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 13\n      }\n    }),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 9\n    }\n  }, __jsx(\"img\", {\n    className: \"photo\" // src={require('@images/' + item.imgSrc)}\n    ,\n    src: \"/static/\".concat(item.imgSrc),\n    alt: title,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 11\n    }\n  })), __jsx(\"div\", {\n    className: \"mouse-move-layer t-0\",\n    onMouseEnter: function onMouseEnter(e) {\n      return onMouseIn && onMouseIn(e, true);\n    },\n    onMouseLeave: function onMouseLeave(e) {\n      return onMouseOut && onMouseOut(e, true);\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 9\n    }\n  }), __jsx(\"div\", {\n    className: \"mouse-move-layer b-0\",\n    onMouseEnter: onMouseIn,\n    onMouseLeave: onMouseOut,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 9\n    }\n  })), __jsx(\"figcaption\", {\n    className: \"content\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 7\n    }\n  }, __jsx(\"h3\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 9\n    }\n  }, title), __jsx(\"p\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 9\n    }\n  }, desc), __jsx(\"div\", {\n    \"layout-align\": \"space-between center\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 9\n    }\n  }, __jsx(\"span\", {\n    className: \"category\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 11\n    }\n  }, category), __jsx(\"a\", _extends({\n    className: \"color-primary bdb-line-primary\"\n  }, visitLinksProps, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 11\n    }\n  }), __jsx(\"span\", {\n    className: \"vam\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 13\n    }\n  }, \"\\u8BBF\\u95EE\\u94FE\\u63A5\"), __jsx(SvgIcon, {\n    className: \"m-l-xs\",\n    component: SvgPaperPlane,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 13\n    }\n  })))), (qrcodeImg || searchKeyword) && __jsx(\"div\", {\n    style: {\n      display: visible ? 'block' : 'none'\n    },\n    className: \"mask-root pos-abs t-0 w-h-100\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 9\n    }\n  }, __jsx(\"div\", {\n    onClick: onVisitContent,\n    className: \"mask-layer w-h-100\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 11\n    }\n  }), qrcodeImg ? __jsx(\"img\", {\n    className: \"pos-abs tblr-0 m-auto\" // src={require(`@images/${qrcodeImg}`)}\n    ,\n    src: \"/static/\".concat(qrcodeImg),\n    alt: \"\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 13\n    }\n  }) : __jsx(\"div\", {\n    className: \"app-dec pos-abs color-white font-size-md\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 13\n    }\n  }, \"\\u8FDB\\u5165\\u5FAE\\u4FE1APP-\", '>', \"\\u70B9\\u51FB\\u53D1\\u73B0-\", '>', \"\\u9009\\u62E9\\u5C0F\\u7A0B\\u5E8F\\u641C-\", '>', \"\\u7D22 \\\"\", __jsx(\"span\", {\n    className: \"color-primary\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 236,\n      columnNumber: 15\n    }\n  }, \" \", searchKeyword, \" \"), \"\\\" \\u8BBF\\u95EE\")));\n};\n\nvar TabsWorksContent = function TabsWorksContent(_ref5) {\n  var _ref5$activeKey = _ref5.activeKey,\n      activeKey = _ref5$activeKey === void 0 ? '' : _ref5$activeKey;\n\n  var _useState3 = useState({\n    data: [],\n    hasNextPage: true,\n    loading: true\n  }),\n      info = _useState3[0],\n      setInfo = _useState3[1];\n\n  var data = info.data,\n      hasNextPage = info.hasNextPage,\n      loading = info.loading;\n\n  var onVisitContent = function onVisitContent(item) {\n    return function (e) {\n      setInfo(function (v) {\n        return _objectSpread({}, v, {\n          data: data.map(function (v) {\n            return _objectSpread({}, v, {}, Object.is(v.imgSrc, item.imgSrc) && {\n              visible: !v.visible\n            });\n          })\n        });\n      });\n      e.preventDefault();\n    };\n  };\n\n  var onMouseIn = function onMouseIn(e, isTop) {\n    var currentDom = e.currentTarget;\n    var parentDom = currentDom.parentNode;\n    var domImg = parentDom === null || parentDom === void 0 ? void 0 : parentDom.querySelector('.photo');\n    if (!domImg) return; // const { clientY } = e\n    // const { top, height } = currentDom.getBoundingClientRect()\n    // const halfHeight = height / 2\n    // const isTop = halfHeight > clientY - top //移入位置\n\n    var marginTopVal = parseFloat(getStyle(domImg).marginTop);\n    var hiddenHeight = (domImg.getBoundingClientRect().height || 0) - parseInt(getStyle(parentDom).maxHeight); //计算隐藏的高度\n\n    var moveTime = 150; //值越大、移动越快，反之\n\n    var moveSpeed = hiddenHeight / moveTime;\n    var restMovDistance = (isTop ? -marginTopVal : hiddenHeight + marginTopVal) * moveSpeed; //移动的距离\n\n    var time = (restMovDistance / hiddenHeight).toFixed(2); //剩余距离需要移动的时间\n\n    domImg.style.cssText = \"margin-top:\".concat(isTop ? 0 : -hiddenHeight, \"px;transition:margin-top \").concat(time, \"s linear;\");\n  };\n\n  var onMouseOut = function onMouseOut(e) {\n    var _currentDom$parentNod;\n\n    var currentDom = e.currentTarget;\n    var domImg = (_currentDom$parentNod = currentDom.parentNode) === null || _currentDom$parentNod === void 0 ? void 0 : _currentDom$parentNod.querySelector('.photo');\n    if (!domImg) return;\n    var marginTopVal = getStyle(domImg).marginTop;\n    domImg.style.cssText = \"margin-top:\".concat(marginTopVal, \";\");\n  };\n\n  var fetchData = function fetchData() {\n    var pageIndex = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;\n    var result = worksInfo[activeKey];\n    if (!result) return;\n    paginationAfterData({\n      query: {\n        pageIndex: pageIndex\n      },\n      data: result.data\n    }).then(function (res) {\n      var list = res.data;\n      var isFirstPage = Object.is(pageIndex, 1);\n      setInfo(function (v) {\n        return _objectSpread({}, v, {}, res, {\n          data: isFirstPage ? list : [].concat(_toConsumableArray(data), _toConsumableArray(list))\n        });\n      });\n    })[\"catch\"](function () {\n      setInfo(function (v) {\n        return _objectSpread({}, v, {\n          hasNextPage: false\n        });\n      });\n    })[\"finally\"](function () {\n      setInfo(function (v) {\n        return _objectSpread({}, v, {\n          loading: false\n        });\n      });\n    });\n  };\n\n  useEffect(function () {\n    setInfo(function (v) {\n      return _objectSpread({}, v, {\n        hasNextPage: true,\n        loading: true\n      });\n    });\n    fetchData();\n  }, [activeKey]);\n\n  var loadFunc = function loadFunc(page) {\n    if (!hasNextPage) return;\n    fetchData(page);\n  };\n\n  return __jsx(\"div\", {\n    className: works_list,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 348,\n      columnNumber: 5\n    }\n  }, loading ? __jsx(Loading, {\n    className: \"tac p-b-xxl\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 350,\n      columnNumber: 9\n    }\n  }) : __jsx(InfiniteScroll, {\n    pageStart: 0,\n    loadMore: loadFunc,\n    hasMore: hasNextPage,\n    loader: __jsx(Loading, {\n      key: \"0\",\n      className: \"tac p-b-xxl\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 356,\n        columnNumber: 19\n      }\n    }),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 352,\n      columnNumber: 9\n    }\n  }, data.map(function (item) {\n    var imgSrc = item.imgSrc;\n    return __jsx(WorkItem, {\n      key: imgSrc,\n      onVisitContent: onVisitContent(item),\n      onMouseIn: onMouseIn,\n      onMouseOut: onMouseOut,\n      item: item,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 361,\n        columnNumber: 15\n      }\n    });\n  }), !hasNextPage && isValidArray(data) && data.length >= DEFAULT_PAGE_SIZE && __jsx(\"div\", {\n    className: \"tac p-b-xxl\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 373,\n      columnNumber: 15\n    }\n  }, \"\\u6CA1\\u6709\\u66F4\\u591A\\u4E86\\u2299\\uFE4F\\u2299\")));\n};\n\nvar Works = function Works() {\n  var _useState4 = useState(''),\n      activeKey = _useState4[0],\n      setActiveKey = _useState4[1];\n\n  return __jsx(\"section\", {\n    className: works_wrapper,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 387,\n      columnNumber: 5\n    }\n  }, __jsx(Banner, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 388,\n      columnNumber: 7\n    }\n  }), __jsx(LayoutMain, {\n    pageTitleProps: {\n      zhName: __jsx(React.Fragment, null, __jsx(\"span\", {\n        className: \"font-family-georgia\",\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 393,\n          columnNumber: 15\n        }\n      }, \"6\"), \"\\u4E2A\\u4F5C\\u54C1\"),\n      enName: 'more than 40 works'\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 389,\n      columnNumber: 7\n    }\n  }, __jsx(StickyContainer, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 399,\n      columnNumber: 9\n    }\n  }, __jsx(TabsWorksHead, {\n    onSwitchTab: function onSwitchTab(key) {\n      return setActiveKey(key);\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 400,\n      columnNumber: 11\n    }\n  }), activeKey && __jsx(TabsWorksContent, {\n    activeKey: activeKey,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 401,\n      columnNumber: 25\n    }\n  }))));\n};\n\nexport default Works;","map":{"version":3,"sources":["C:/Users/19215/Desktop/my_website/src/pages/works.tsx"],"names":["React","useState","useEffect","useRef","useContext","classNames","Lazyload","StickyContainer","Sticky","InfiniteScroll","styles","findDataIndex","getStyle","paginationAfterData","isValidArray","DEFAULT_PAGE_SIZE","worksInfo","CtxStore","Banner","SvgIcon","Loading","LayoutMain","ReactComponent","SvgPaperPlane","works_wrapper","works_list","worksKeys","Object","keys","DEFAULT_ACTIVE_KEY","tabHeadInfo","map","key","data","rest","num","length","TabsWorksHead","onSwitchTab","style","store","bodyStyle","elTabs","activeKey","setActiveKey","width","offsetX","activeInfo","setActiveInfo","onSelected","e","preventDefault","currentTarget","offsetWidth","offsetLeft","v","initialTabsActive","current","index","target","is","node","querySelectorAll","click","isSticky","boxShadow","title","isHot","top","transform","transition","WorkItem","item","onVisitContent","onMouseIn","onMouseOut","category","desc","qrcodeImg","searchKeyword","visible","links","visitLinksProps","href","onClick","imgSrc","display","TabsWorksContent","hasNextPage","loading","info","setInfo","isTop","currentDom","parentDom","parentNode","domImg","querySelector","marginTopVal","parseFloat","marginTop","hiddenHeight","getBoundingClientRect","height","parseInt","maxHeight","moveTime","moveSpeed","restMovDistance","time","toFixed","cssText","fetchData","pageIndex","result","query","then","res","list","isFirstPage","loadFunc","page","Works","zhName","enName"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef, useContext } from 'react'\r\nimport classNames from 'classnames'\r\nimport Lazyload from 'react-lazyload'\r\nimport { StickyContainer, Sticky } from '@components/react-sticky'\r\nimport InfiniteScroll from 'react-infinite-scroller'\r\n\r\nimport styles from '@styles/sass/page/works.module.scss'\r\n\r\nimport {\r\n  findDataIndex,\r\n  getStyle,\r\n  paginationAfterData,\r\n  isValidArray,\r\n} from '@scripts/utils'\r\nimport { DEFAULT_PAGE_SIZE } from '@scripts/constant'\r\nimport { worksInfo } from '@store/mock'\r\n\r\nimport { CtxStore } from '../components/context'\r\n\r\nimport { Banner, SvgIcon, Loading } from '@components/common'\r\nimport { LayoutMain } from '@components/layout'\r\n\r\nimport { ReactComponent as SvgPaperPlane } from '@fonts/svg/merge/paper-plane.svg'\r\n\r\nconst { works_wrapper, works_list } = styles\r\n\r\nconst worksKeys = Object.keys(worksInfo)\r\nconst DEFAULT_ACTIVE_KEY = worksKeys[0]\r\n\r\nconst tabHeadInfo: {\r\n  num: number\r\n  title: string\r\n  key: string\r\n  isHot?: boolean\r\n}[] = worksKeys.map((key) => {\r\n  const { data, ...rest } = worksInfo[key]\r\n  return {\r\n    key,\r\n    num: data.length,\r\n    ...rest,\r\n  }\r\n})\r\n\r\nconst TabsWorksHead: React.FC<{\r\n  onSwitchTab?: (key: string) => void\r\n  style?: React.CSSProperties\r\n}> = ({ onSwitchTab, style }) => {\r\n  const { store } = useContext(CtxStore)\r\n  const { bodyStyle } = store\r\n  const elTabs = useRef<HTMLDivElement>(null)\r\n  const [activeKey, setActiveKey] = useState(DEFAULT_ACTIVE_KEY)\r\n  const [activeInfo, setActiveInfo] = useState({\r\n    width: 0,\r\n    offsetX: 0,\r\n  })\r\n\r\n  const { width, offsetX } = activeInfo\r\n\r\n  const onSelected = (key) => {\r\n    return (e: React.MouseEvent<HTMLAnchorElement>) => {\r\n      e.preventDefault()\r\n      setActiveKey(key)\r\n      const { offsetWidth, offsetLeft } = e.currentTarget\r\n      setActiveInfo((v) => ({\r\n        ...v,\r\n        width: offsetWidth,\r\n        offsetX: offsetLeft,\r\n      }))\r\n      onSwitchTab && onSwitchTab(key)\r\n    }\r\n  }\r\n\r\n  const initialTabsActive = () => {\r\n    const { current } = elTabs\r\n    const index = findDataIndex({\r\n      data: tabHeadInfo,\r\n      key: 'key',\r\n      target: activeKey,\r\n    })\r\n    if (Object.is(index, -1)) return\r\n    const node = current?.querySelectorAll('a')[index]\r\n    node?.click()\r\n  }\r\n\r\n  useEffect(initialTabsActive, [])\r\n\r\n  return (\r\n    <Sticky>\r\n      {({ style, isSticky }) => {\r\n        return (\r\n          <div\r\n            style={{\r\n              ...style,\r\n              ...(isSticky && {\r\n                boxShadow: 'rgb(0, 0, 0,.24) 0px 0px 4px',\r\n                ...bodyStyle,\r\n              }),\r\n            }}\r\n            className=\"tac tabs-wrapper z-1\"\r\n          >\r\n            <div ref={elTabs} className=\"inline-block pos-rel font-size-sm\">\r\n              {tabHeadInfo.map(({ title, num, key, isHot }) => (\r\n                <a\r\n                  key={key}\r\n                  href=\"#\"\r\n                  onClick={onSelected(key)}\r\n                  className={classNames('m-l-r-xl p-b-xxs', {\r\n                    'color-primary active': Object.is(activeKey, key),\r\n                  })}\r\n                >\r\n                  {title} ({' '}\r\n                  <span className=\"font-family-georgia font-size-xxl\">\r\n                    {num}\r\n                    {isHot && (\r\n                      <span className=\"hot pos-rel\">\r\n                        <em\r\n                          style={{\r\n                            top: 4,\r\n                          }}\r\n                        />\r\n                      </span>\r\n                    )}\r\n                  </span>{' '}\r\n                  )\r\n                </a>\r\n              ))}\r\n              <div\r\n                style={{\r\n                  width: width,\r\n                  transform: `translateX(${offsetX}px)`,\r\n                  transition: '.5s',\r\n                }}\r\n                className=\"tabs-active\"\r\n              ></div>\r\n            </div>\r\n          </div>\r\n        )\r\n      }}\r\n    </Sticky>\r\n  )\r\n}\r\n\r\ntype TOnEventFunc = (event: React.MouseEvent) => void\r\ntype TOnMouseEventFunc = (e: React.MouseEvent, isTop?: boolean) => void\r\n\r\nconst WorkItem: React.FC<{\r\n  item?: Dictionary\r\n  onVisitContent?: TOnEventFunc\r\n  onMouseIn?: TOnMouseEventFunc\r\n  onMouseOut?: TOnMouseEventFunc\r\n}> = ({ item = {}, onVisitContent, onMouseIn, onMouseOut }) => {\r\n  const {\r\n    category,\r\n    desc,\r\n    qrcodeImg,\r\n    title,\r\n    searchKeyword,\r\n    visible,\r\n    links,\r\n  } = item\r\n\r\n  const visitLinksProps = {\r\n    href: links || '#',\r\n    title,\r\n    ...(links\r\n      ? {\r\n          target: '_blank',\r\n        }\r\n      : {\r\n          onClick: onVisitContent,\r\n        }),\r\n  }\r\n\r\n  return (\r\n    <figure className=\"item\">\r\n      <a className=\"block\" {...visitLinksProps}>\r\n        <Lazyload\r\n          once\r\n          throttle={200}\r\n          height={400}\r\n          placeholder={\r\n            <img\r\n              // className=\"w-h-100\" //勿设置\r\n              src={`/static/placeholder-pic.png`}\r\n              alt=\"\"\r\n            />\r\n          }\r\n        >\r\n          <img\r\n            className=\"photo\"\r\n            // src={require('@images/' + item.imgSrc)}\r\n            src={`/static/${item.imgSrc}`}\r\n            alt={title}\r\n          />\r\n        </Lazyload>\r\n        <div\r\n          className=\"mouse-move-layer t-0\"\r\n          onMouseEnter={(e) => onMouseIn && onMouseIn(e, true)}\r\n          onMouseLeave={(e) => onMouseOut && onMouseOut(e, true)}\r\n        />\r\n        <div\r\n          className=\"mouse-move-layer b-0\"\r\n          onMouseEnter={onMouseIn}\r\n          onMouseLeave={onMouseOut}\r\n        />\r\n      </a>\r\n      <figcaption className=\"content\">\r\n        <h3>{title}</h3>\r\n        <p>{desc}</p>\r\n        <div layout-align=\"space-between center\">\r\n          <span className=\"category\">{category}</span>\r\n          <a className=\"color-primary bdb-line-primary\" {...visitLinksProps}>\r\n            <span className=\"vam\">访问链接</span>\r\n            <SvgIcon className=\"m-l-xs\" component={SvgPaperPlane} />\r\n          </a>\r\n        </div>\r\n      </figcaption>\r\n      {(qrcodeImg || searchKeyword) && (\r\n        <div\r\n          style={{\r\n            display: visible ? 'block' : 'none',\r\n          }}\r\n          className=\"mask-root pos-abs t-0 w-h-100\"\r\n        >\r\n          <div onClick={onVisitContent} className=\"mask-layer w-h-100\" />\r\n          {qrcodeImg ? (\r\n            <img\r\n              className=\"pos-abs tblr-0 m-auto\"\r\n              // src={require(`@images/${qrcodeImg}`)}\r\n              src={`/static/${qrcodeImg}`}\r\n              alt=\"\"\r\n            />\r\n          ) : (\r\n            <div className=\"app-dec pos-abs color-white font-size-md\">\r\n              进入微信APP-{'>'}点击发现-{'>'}选择小程序搜-{'>'}索 \"\r\n              <span className=\"color-primary\"> {searchKeyword} </span>\" 访问\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </figure>\r\n  )\r\n}\r\n\r\nconst TabsWorksContent: React.FC<{\r\n  activeKey?: string\r\n}> = ({ activeKey = '' }) => {\r\n  const [info, setInfo] = useState<Dictionary>({\r\n    data: [],\r\n    hasNextPage: true,\r\n    loading: true,\r\n  })\r\n  const { data, hasNextPage, loading } = info\r\n\r\n  const onVisitContent = (item) => {\r\n    return (e) => {\r\n      setInfo((v) => ({\r\n        ...v,\r\n        data: data.map((v) => ({\r\n          ...v,\r\n          ...(Object.is(v.imgSrc, item.imgSrc) && {\r\n            visible: !v.visible,\r\n          }),\r\n        })),\r\n      }))\r\n      e.preventDefault()\r\n    }\r\n  }\r\n\r\n  const onMouseIn: TOnMouseEventFunc = (e, isTop) => {\r\n    const currentDom = e.currentTarget\r\n    const parentDom = currentDom.parentNode\r\n    const domImg = parentDom?.querySelector<HTMLImageElement>('.photo')\r\n    if (!domImg) return\r\n    // const { clientY } = e\r\n    // const { top, height } = currentDom.getBoundingClientRect()\r\n    // const halfHeight = height / 2\r\n    // const isTop = halfHeight > clientY - top //移入位置\r\n    const marginTopVal = parseFloat(getStyle(domImg).marginTop)\r\n    const hiddenHeight =\r\n      (domImg.getBoundingClientRect().height || 0) -\r\n      parseInt(getStyle(parentDom).maxHeight) //计算隐藏的高度\r\n\r\n    const moveTime = 150 //值越大、移动越快，反之\r\n    const moveSpeed = hiddenHeight / moveTime\r\n    const restMovDistance =\r\n      (isTop ? -marginTopVal : hiddenHeight + marginTopVal) * moveSpeed //移动的距离\r\n    const time = (restMovDistance / hiddenHeight).toFixed(2) //剩余距离需要移动的时间\r\n\r\n    domImg.style.cssText = `margin-top:${\r\n      isTop ? 0 : -hiddenHeight\r\n    }px;transition:margin-top ${time}s linear;`\r\n  }\r\n\r\n  const onMouseOut: TOnMouseEventFunc = (e) => {\r\n    const currentDom = e.currentTarget\r\n    const domImg = currentDom.parentNode?.querySelector<HTMLImageElement>(\r\n      '.photo'\r\n    )\r\n    if (!domImg) return\r\n    const marginTopVal = getStyle(domImg).marginTop\r\n    domImg.style.cssText = `margin-top:${marginTopVal};`\r\n  }\r\n\r\n  const fetchData = (pageIndex: number = 1) => {\r\n    const result = worksInfo[activeKey]\r\n    if (!result) return\r\n    paginationAfterData({\r\n      query: {\r\n        pageIndex,\r\n      },\r\n      data: result.data,\r\n    })\r\n      .then((res) => {\r\n        const { data: list } = res\r\n        const isFirstPage = Object.is(pageIndex, 1)\r\n        setInfo((v) => ({\r\n          ...v,\r\n          ...res,\r\n          data: isFirstPage ? list : [...data, ...list],\r\n        }))\r\n      })\r\n      .catch(() => {\r\n        setInfo((v) => ({\r\n          ...v,\r\n          hasNextPage: false,\r\n        }))\r\n      })\r\n      .finally(() => {\r\n        setInfo((v) => ({\r\n          ...v,\r\n          loading: false,\r\n        }))\r\n      })\r\n  }\r\n\r\n  useEffect(() => {\r\n    setInfo((v) => ({ ...v, hasNextPage: true, loading: true }))\r\n    fetchData()\r\n  }, [activeKey])\r\n\r\n  const loadFunc = (page) => {\r\n    if (!hasNextPage) return\r\n    fetchData(page)\r\n  }\r\n\r\n  return (\r\n    <div className={works_list}>\r\n      {loading ? (\r\n        <Loading className=\"tac p-b-xxl\" />\r\n      ) : (\r\n        <InfiniteScroll\r\n          pageStart={0}\r\n          loadMore={loadFunc}\r\n          hasMore={hasNextPage}\r\n          loader={<Loading key=\"0\" className=\"tac p-b-xxl\" />}\r\n        >\r\n          {data.map((item) => {\r\n            const { imgSrc } = item\r\n            return (\r\n              <WorkItem\r\n                key={imgSrc}\r\n                onVisitContent={onVisitContent(item)}\r\n                onMouseIn={onMouseIn}\r\n                onMouseOut={onMouseOut}\r\n                item={item}\r\n              />\r\n            )\r\n          })}\r\n          {!hasNextPage &&\r\n            isValidArray(data) &&\r\n            data.length >= DEFAULT_PAGE_SIZE && (\r\n              <div className=\"tac p-b-xxl\">没有更多了⊙﹏⊙</div>\r\n            )}\r\n        </InfiniteScroll>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n\r\ninterface IWorksProps {}\r\n\r\nconst Works: React.FC<IWorksProps> = () => {\r\n  const [activeKey, setActiveKey] = useState('')\r\n\r\n  return (\r\n    <section className={works_wrapper}>\r\n      <Banner />\r\n      <LayoutMain\r\n        pageTitleProps={{\r\n          zhName: (\r\n            <>\r\n              <span className=\"font-family-georgia\">6</span>个作品\r\n            </>\r\n          ),\r\n          enName: 'more than 40 works',\r\n        }}\r\n      >\r\n        <StickyContainer>\r\n          <TabsWorksHead onSwitchTab={(key) => setActiveKey(key)} />\r\n          {activeKey && <TabsWorksContent activeKey={activeKey} />}\r\n        </StickyContainer>\r\n      </LayoutMain>\r\n    </section>\r\n  )\r\n}\r\n\r\nexport default Works\r\n"]},"metadata":{},"sourceType":"module"}